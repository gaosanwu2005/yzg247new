{extend name="platform/base" /}
{block name="resources"/}
<style type="text/css">
    .required{
        color:red;margin-right:10px;
    }
    .error{
        font-size: 12px;
        line-height: 16px;
        color: red;
        margin-top: 10px;
        display:none;
    }
</style>
{/block}
{block name="main"}
<section class="panel panel-default">
    <header class="panel-heading font-bold"> 添加会员报名信息</header>
    <div class="panel-body">
        <form class="form-horizontal" id="form" name="form" onsubmit="">
            <div class="form-group">
                <label class="col-sm-2 control-label"><span class="required">*</span>姓名</label>
                <div class="col-md-6">
                    <input type="text" class="form-control" id="realname" value="" name="sex">
                </div>
                <p class="error">请输入姓名</p>
            </div>
            <div class="line line-dashed line-lg pull-in"></div>
            <div class="form-group">
                <label class="col-sm-2 control-label"><span class="required">*</span>性别</label>
                <div class="col-sm-4">
                    <select id="sex" name="sex" class="form-control m-b">
                        <option value="0">请选择</option>
                        <option value="1">男</option>
                        <option value="2">女</option>
                    </select>
                </div>
                <p class="error">请选择性别</p>
            </div>
            <div class="line line-dashed line-lg pull-in"></div>
            <div class="form-group">
                <label class="col-sm-2 control-label">民族</label>
                <div class="col-md-4">
                    <input type="text" class="form-control" id="national" value="" name="national">
                </div>
            </div>
            <div class="line line-dashed line-lg pull-in"></div>
            <div class="form-group">
                <label class="col-sm-2 control-label"><span class="required">*</span>证件类型</label>
                <div class="col-sm-4">
                    <select id="type" name="type" class="form-control m-b">
                        <option value="0">请选择</option>
                        <option value="1">身份证</option>
                        <option value="2">护照</option>
                    </select>
                </div>
                <p class="error">请选择证件类型</p>
            </div>
            <div class="line line-dashed line-lg pull-in"></div>
            <div class="form-group">
                <label class="col-sm-2 control-label">证件号码</label>
                <div class="col-md-4">
                    <input type="text" class="form-control" id="idcard" value="" name="idcard">
                </div>
            </div>
            <div class="line line-dashed line-lg pull-in"></div>
            <div class="form-group">
                <label class="col-sm-2 control-label">生日</label>
                <div class="col-md-4">
                    <input type="text" class="form-control" id="birthday" value="" name="birthday">
                </div>
            </div>
            <div class="line line-dashed line-lg pull-in"></div>
            <div class="form-group">
                <label class="col-sm-2 control-label">收货地址</label>
                <div class="col-md-4">
                    <input type="text" class="form-control" id="address2" value="" name="address2">
                </div>
            </div>
            <div class="line line-dashed line-lg pull-in"></div>
            <div class="form-group">
                <label class="col-sm-2 control-label">手机</label>
                <div class="col-md-4">
                    <input type="text" class="form-control" id="mobile" value="" name="mobile">
                </div>
            </div>
            <div class="line line-dashed line-lg pull-in"></div>
            <div class="form-group">
                <label class="col-sm-2 control-label">备用手机</label>
                <div class="col-md-4">
                    <input type="text" class="form-control" id="mobile2" value="" name="mobile2">
                </div>
            </div>
            <div class="line line-dashed line-lg pull-in"></div>
            <!-- 上传图片 -->
            <div class="form-group">
                <label class="col-sm-2 control-label">身份证照片</label>
                <div class="col-sm-4">
                    <p><img id="imgLogo1" src="" class="imglogo1"/></p>
                    <a href="javascript:void(0);" style="display:block;position:relative;z-index:1;">
                                   		<span style="width: 97px;height: 34px;position: absolute;left: 0;top: 0;z-index: 2;cursor: pointer;">
                                   		<input hidefocus="true" size="1" class="input-file" name="file_upload1"
                                               id="uploadImg1" nc_type="change_store_label" type="file" style="width: 97px;height: 34px;padding: 0;margin: 0;border: none 0;opacity: 0;filter: alpha(opacity = 0);cursor: pointer;"
                                               onchange="imgUpload1(this);">
					<input type="hidden" id="Logo1" value="" />
				</span>
                        <a class="btn btn-default"><i class="fa fa-cloud-upload text"></i><span class="text">上传图片</span></a>
                    </a>
                </div>
            </div>
            <div class="line line-dashed line-lg pull-in"></div>
            <div class="form-group">
                <label class="col-sm-2 control-label">毕业证照片</label>
                <div class="col-sm-4">
                    <p><img id="imgLogo2" src="" class="imglogo2"/></p>
                    <a href="javascript:void(0);" style="display:block;position:relative;z-index:1;">
                                   		<span style="width: 97px;height: 34px;position: absolute;left: 0;top: 0;z-index: 2;cursor: pointer;">
                                   		<input hidefocus="true" size="1" class="input-file" name="file_upload2"
                                               id="uploadImg2" nc_type="change_store_label" type="file" style="width: 97px;height: 34px;padding: 0;margin: 0;border: none 0;opacity: 0;filter: alpha(opacity = 0);cursor: pointer;"
                                               onchange="imgUpload2(this);">
					<input type="hidden" id="Logo2" value="" />
				</span>
                        <a class="btn btn-default"><i class="fa fa-cloud-upload text"></i><span class="text">上传图片</span></a>
                    </a>
                </div>
            </div>
            <div class="line line-dashed line-lg pull-in"></div>
            <div class="form-group">
                <label class="col-sm-2 control-label">本人照片</label>
                <div class="col-sm-4">
                    <p><img id="imgLogo3" src="" class="imglogo3"/></p>
                    <a href="javascript:void(0);" style="display:block;position:relative;z-index:1;">
                                   		<span style="width: 97px;height: 34px;position: absolute;left: 0;top: 0;z-index: 2;cursor: pointer;">
                                   		<input hidefocus="true" size="1" class="input-file" name="file_upload3"
                                               id="uploadImg3" nc_type="change_store_label" type="file" style="width: 97px;height: 34px;padding: 0;margin: 0;border: none 0;opacity: 0;filter: alpha(opacity = 0);cursor: pointer;"
                                               onchange="imgUpload3(this);">
					<input type="hidden" id="Logo3" value="" />
				</span>
                        <a class="btn btn-default"><i class="fa fa-cloud-upload text"></i><span class="text">上传图片</span></a>
                    </a>
                </div>
            </div>
            <div class="line line-dashed line-lg pull-in"></div>
            <div class="form-group">
                <label class="col-sm-2 control-label"><span class="required">*</span>报考院校</label>
                <div class="col-sm-4">
                    <select id="school" name="school" class="form-control m-b">
                        <option value="0">请选择</option>
                        {volist name="schools" id="vo" empty="暂时没有数据" }
                        <option value="{$vo.id}" {eq name="info.school" value="$vo.id"}selected = "selected"{/eq}>{$vo.name}</option>
                        {/volist}
                    </select>
                </div>
                <p class="error">请选择报考院校</p>
            </div>
            <div class="line line-dashed line-lg pull-in"></div>
            <div class="form-group">
                <label class="col-sm-2 control-label"><span class="required">*</span>报考专业</label>
                <div class="col-sm-4">
                    <select id="professional" name="professional" class="form-control m-b">
                        <option value="0">请选择</option>
                        {volist name="professional" id="vo" empty="暂时没有数据" }
                        <option value="{$vo.id}">{$vo.name}</option>
                        {/volist}
                    </select>
                </div>
                <p class="error">请选择报考专业</p>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label"><span class="required">*</span>提升层次</label>
                <div class="col-sm-4">
                    <select id="record" name="record" class="form-control m-b">
                        <option value="0">请选择</option>
                        {volist name="record" id="vo" empty="暂时没有数据" }
                        <option value="{$vo.id}">{$vo.name}</option>
                        {/volist}
                    </select>
                </div>
                <p class="error">请选择提升层次</p>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label"><span class="required">*</span>上课类型</label>
                <div class="col-sm-4">
                    <select id="classtype" name="classtype" class="form-control m-b">
                        <option value="0">请选择</option>
                        {volist name="classtype" id="vo" empty="暂时没有数据" }
                        <option value="{$vo.id}">{$vo.name}</option>
                        {/volist}
                    </select>
                </div>
                <p class="error">请选择上课类型</p>
            </div>

            <div class="form-group">
                <div class="col-sm-4 col-sm-offset-2">
                    <a href="javascript:void(0);" onclick="save(1)" class="btn btn-primary">提交会员报名信息</a>
                </div>
            </div>
        </form>
    </div>
</section>
{/block}
{block name="script"}
<script src="PLATFORM_JS/ajaxFileUpload.js" type="text/javascript"></script>
<script src="__STATIC__/js/file_upload.js" type="text/javascript"></script>
{include file="platform/openDialog" /}
<script type="text/javascript">

    function save(type){
        var comment_flag=$('#comment_flag').is(':checked')?'1':'0';
        var commend_flag=$('#commend_flag').is(':checked')?'1':'0';
        var title=$("#title").val();
        var class_id=$("#class_id").val();
        var short_title=$("#short_title").val();
        var source=$("#source").val();
        var url=$("#url").val();
        var author=$("#author").val();
        var summary=$("#summary").val();
        var content=$("#editor").text();
        var image=$("#Logo").val();
        var keyword=$("#keyword").val();
        var article_id_array=$("#article_id_array").val();
        var click=$("#click").val();
        var sort=$("#sort").val();
        var tag=$("#tag").val();
        var comment_count=$("#comment_count").val();
        var share_count=$("#share_count").val();
        var attachment_path='';

        $('.files>p>span').each(function(){
            attachment_path+=$(this).text()+',';
        })
        attachment_path=attachment_path.substring(0,attachment_path.length-1);
        if(verify(title,class_id,content)){
            $.ajax({
                type:"post",
                url:"{:__URL('PLATFORM_MAIN/Cms/addArticle')}",
                data:{
                    'title':title,
                    'class_id':class_id,
                    'short_title':short_title,
                    'source':source,
                    'url':url,
                    'author':author,
                    'summary':summary,
                    'content':content,
                    'image':image,
                    'keyword':keyword,
                    'article_id_array':article_id_array,
                    'click':click,
                    'sort':sort,
                    'commend_flag':commend_flag,
                    'comment_flag':comment_flag,
                    'attachment_path':attachment_path,
                    'tag':tag,
                    'comment_count':comment_count,
                    'share_count':share_count,
                },
                async : true,
                success:function(data){
                    //alert(JSON.stringify(data));
                    if (data["code"] > 0) {
                        showMessage('success', data["message"]);
                        if(type==1){
                            location.href = "{:__URL('PLATFORM_MAIN/cms/articlelist')}";
                        }
                        if(type==2){
                            window.open(__URL("SHOP_MAIN/Cms/articleClassInfo?article_id="+data['code']));
                        }
                    }else{
                        showMessage('error', data["message"]);
                    }
                }

            });

        }
    }
    /**
     *模块输入信息验证
     */
    function verify(title,class_id,content){
        if(title==''){
            $("#title").parent().next(".error").show();
            $("#title").focus();
            return false;
        }else{
            $(".error").hide();
        }
        if(class_id==0){
            $("#class_id").parent().next(".error").show();
            $("#class_id").focus();
            return false;
        }else{
            $(".error").hide();
        }
        if(content==null || content.length==0){
            $("#editor").parent().next(".error").show();
            $("#editor").focus();
            return false;
        }else{
            $(".error").hide();
        }
        return true;
    }
    /**
     *图片上传
     */
    function imgUpload(event) {
        var fileid = $(event).attr("id");
        var data = { 'file_path' : UPLOADCOMMON };
        uploadFile(fileid,data,function(res){
            if(res.code){
                $("#imgLogo").attr("src","__UPLOAD__/"+res.data);
                $("#Logo").val(res.data);
                showTip(res.message,"success");
            }else{
                showTip(res.message,"error");
            }
        });
    }

    /**
     *图片上传2
     */
    function imgUpload2(event) {
        var fileid = $(event).attr("id");
        var data = { 'file_path' : UPLOADCOMMON };
        uploadFile(fileid,data,function(res){
            if(res.code){
                $("#imgLogo").attr("src","__UPLOAD__/"+res.data);
                $("#Logo").val(res.data);
                showTip(res.message,"success");
            }else{
                showTip(res.message,"error");
            }
        });
    }
    /**
     *图片上传3
     */
    function imgUpload3(event) {
        var fileid = $(event).attr("id");
        var data = { 'file_path' : UPLOADCOMMON };
        uploadFile(fileid,data,function(res){
            if(res.code){
                $("#imgLogo").attr("src","__UPLOAD__/"+res.data);
                $("#Logo").val(res.data);
                showTip(res.message,"success");
            }else{
                showTip(res.message,"error");
            }
        });
    }
    /**
     *上传附件
     */
    function FileUpload(event) {
        var fileid = "file_upload_input";
        if($('#'+fileid).val()==''){
            $( "#dialog" ).dialog({
                buttons: {
                    "确定,#e57373": function() {
                        $(this).dialog('close');
                    }
                },
                contentText:"请选择附件"
            });
        }else{
            $.ajaxFileUpload({
                url : "{:__URL('PLATFORM_MAIN/system/file_upload')}", //用于文件上传的服务器端请求地址
                secureuri : false, //一般设置为false
                fileElementId : fileid, //文件上传空间的id属性  <input type="file" id="file" name="file" />
                dataType : 'text', //返回值类型 一般设置为json
                async : false,
                data:{'Enclosure':1},
                contentType : "text/json;charset=utf-8",
                success : function(data) //服务器成功响应处理函数
                {
                    //alert(data);
                    if (data) {
                        $( "#dialog" ).dialog({
                            buttons: {
                                "确定,#01B044": function() {
                                    $(this).dialog('close');
                                }
                            },
                            contentText:"附件上传成功",
                            time:1,
                        });
                        $('.files').append('<p><span>'+data+'</span><a href="javascript:;" onclick="delete_file(\''+data+'\',this)">删除</a></p>');
                    }else{
                        $( "#dialog" ).dialog({
                            buttons: {
                                "确定,#e57373": function() {
                                    $(this).dialog('close');
                                }
                            },
                            contentText:"附件上传失败"
                        });
                    }
                }
            });
        }

    }

</script>

{/block}